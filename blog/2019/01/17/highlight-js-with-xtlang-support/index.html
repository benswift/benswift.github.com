<!DOCTYPE html>
<html lang="en-AU">
  <head>
	<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="theme-color" content="#be2edd">
<link rel="stylesheet" type="text/css" href="/assets/css/normalize-9930e054e512c7aeb21cfc22c0816d7f701b97910a1bd67954c03be76c9f3e90.css">

<!-- fontawesome -->
<script defer src="https://use.fontawesome.com/releases/v5.6.3/js/all.js" integrity="sha384-EIHISlAOj4zgYieurP0SdoiBYfGJKkgWedPHH4jCzpCXLmzVsw1ouK59MuUtP4a1" crossorigin="anonymous"></script>

<!-- anchor.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.2.0/anchor.min.js" integrity="sha256-m1eTvwEHwmsw4+XKF7BshClVJEPwTVycveNl0CS0Mkk=" crossorigin="anonymous"></script>

<script>
 anchors.options = {
   visible: "touch",
   icon: "#"
 };
 document.addEventListener("DOMContentLoaded", function(event) {
   anchors.add("article > h2, article > h3");
 });
</script>


<!-- highlight.js -->
<script src="/assets/js/highlight.pack-cf914cddba9ab5aaea7819f239c3df41f840b83b1c8c54e37675236e6b2ed74c.js" type="text/javascript"></script>
<link rel="stylesheet" type="text/css" href="/assets/css/atom-one-dark-470b7658ef8aee2f2bb86babcc8a359491361d94113130f47878659a07f47eac.css">

<script>
 hljs.initHighlightingOnLoad();
</script>


<!-- Begin Jekyll SEO tag v2.6.1 -->
<title>highlight.js with xtlang support | benswift.me</title>
<meta name="generator" content="Jekyll v3.8.6" />
<meta property="og:title" content="highlight.js with xtlang support" />
<meta name="author" content="Ben Swift" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="It is a truth, universally acknowledged, that all programming language authors must also be expert web developers. (attributed to Jane Austen)" />
<meta property="og:description" content="It is a truth, universally acknowledged, that all programming language authors must also be expert web developers. (attributed to Jane Austen)" />
<link rel="canonical" href="https://benswift.me/blog/2019/01/17/highlight-js-with-xtlang-support/" />
<meta property="og:url" content="https://benswift.me/blog/2019/01/17/highlight-js-with-xtlang-support/" />
<meta property="og:site_name" content="benswift.me" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-01-17T10:54:00+11:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="highlight.js with xtlang support" />
<meta name="twitter:site" content="@benswift" />
<meta name="twitter:creator" content="@Ben Swift" />
<script type="application/ld+json">
{"url":"https://benswift.me/blog/2019/01/17/highlight-js-with-xtlang-support/","headline":"highlight.js with xtlang support","dateModified":"2019-01-17T10:54:00+11:00","datePublished":"2019-01-17T10:54:00+11:00","author":{"@type":"Person","name":"Ben Swift"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://benswift.me/blog/2019/01/17/highlight-js-with-xtlang-support/"},"description":"It is a truth, universally acknowledged, that all programming language authors must also be expert web developers. (attributed to Jane Austen)","@type":"BlogPosting","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


	<link rel="stylesheet" type="text/css" href="/assets/css/main-fa3c3362a4ed0f3517c2bba7752c287108bda00baaad52995b02fe600ff5a73d.css">
  </head>
  <body>
	<div class="container">
	  <header>

  <nav class="logo" aria-label="site home">
	<a href="/">benswift.me</a>
  </nav>

  <nav class="navigation" aria-label="main navigation">
	<!-- in-site navigation -->
	
	

	<a class="current"href="/blog/index.html">blog</a>
	<a href="/research/">research</a>
	<a href="/teaching/">teaching</a>
	<a href="/livecoding/index.html">livecoding</a>
	<a href="/talks/index.html">talks</a>
	<a href="/bio/">bio</a>

	<!-- social icons -->
	<a href="https://github.com/benswift"><i title="benswift on GitHub" class="fab fa-github"></i></a>
	<a href="https://twitter.com/benswift"><i title="benswift on twitter" class="fab fa-twitter"></i></a>
	<a href="https://vimeo.com/benswift"><i title="benswift on Vimeo" class="fab fa-vimeo"></i></a>
	<a href="https://scholar.google.com/citations?user=OQdYgLEAAAAJ"><i title="Ben's Google Scholar profile" class="fas fa-graduation-cap"></i></a>
	<a href="/feed.xml"><i title="RSS feed for this blog" class="fas fa-rss"></i></a>
	<a href="mailto:ben@benswift.me"><i title="send Ben an email" class="fas fa-envelope"></i></a>
  </nav>

</header>

	  <main aria-label="Content">
		<article>
  <p class="post-date">17 Jan '19</p>
  <h1>highlight.js with xtlang support</h1>
  
<p class="post-tag-container">
  
  <a class="post-tag" href="/blog/tag/web/">
	web
  </a>
  
</p>


  <blockquote>
  <p>It is a truth, universally acknowledged, that all programming language authors
must also be expert web developers. (<em>attributed to Jane Austen</em>)</p>
</blockquote>

<p>I’ve just spent a solid day wrestling with source code syntax highlighting on my
blog, and I’ve finally got it figured out. Tada:</p>

<pre><code class="language-armasm">labelious:
  sub r0, 1
  bne doneski
  b labelious

doneski:
  nop
</code></pre>

<p>I know you’ve got questions, so the rest of this post will be structured as an
<strong>FAQ</strong>.</p>

<h2 id="faq">FAQ</h2>

<h3 id="why-did-you-even-do-that-it-seemed-to-be-working-fine-before">Why did you even do that? It seemed to be working fine before.</h3>

<p>Yes, well, it was mostly working fine. But I was just using an
off-the-shelf<sup id="fnref:cdn"><a href="#fn:cdn" class="footnote">1</a></sup> disribution of <a href="https://highlightjs.org/">highlight.js</a>,
which supported a bunch of languages but not all the ones I need. Especially
Extempore, which is super-important for showing off my livecoding stuff on this
blog.</p>

<h3 id="does-extemporextlang-have-highlightjs-support-now">Does Extempore/xtlang have highlight.js support now?</h3>

<p>Yep, <a href="https://github.com/cyblue9"><code>@blue9</code></a> ported the <a href="https://bitbucket.org/birkenfeld/pygments-main/src/7941677dc77d4f2bf0bbd6140ade85a9454b8b80/pygments/lexers/lisp.py?at=default&amp;fileviewer=file-view-default#lisp.py-2420">Scheme/xtlang
lexer</a>
that I wrote for Pygments, which is a <em>big</em> help to the Extempore community
(thanks <code>blue9</code>).</p>

<h3 id="isnt-it-just-a-matter-of-adding-xtlang-to-the-highlightjs-build-step">Isn’t it just a matter of adding <code>xtlang</code> to the highlight.js build step?</h3>

<p>No, because <a href="https://github.com/highlightjs/highlightjs-xtlang#usage">reasons</a>.
It’s a real mess, and we’re waiting on <a href="https://github.com/highlightjs/highlight.js/pull/1888">this
PR</a> to land before it
gets easier.</p>

<h3 id="howd-you-get-it-working-then">How’d you get it working, then?</h3>

<p>Hacks upon hacks. If you really wanna know, it’s in <a href="https://github.com/benswift/benswift.github.io/tree/hljs-with-xtlang">this
branch</a>
(although the final product, <code>highlight.pack.js</code> is in the main <code>source</code>
branch).</p>

<p>Basically, I backported the Extempore language support from the new “plugin” way
of doing things (which is better, but doesn’t really work yet) to the old
“built-in” way of doing things, and then generated a new, custom build of
highlight.js which included both xtlang and all the other languages that I need
for my blog.</p>

<h3 id="so-can-i-see-some-xtlang-code-then">So can I see some xtlang code, then?</h3>

<p>Sure, here’s an example function from
<a href="https://github.com/digego/extempore/blob/master/examples/core/extempore_lang.xtm"><code>examples/core/extempore_lang.xtm</code></a>.</p>

<pre><code class="language-xtlang">(bind-func my-test-7
  (lambda ()
    (let ((a:&lt;i64,double&gt;* (alloc)) ; returns pointer to type &lt;i64,double&gt;
          (b 37)
          (c 6.4))
      (tuple-set! a 0 b) ;; set i64 to 64
      (tset! a 1 c) ;; set double to 6.4 - tset! is an alias for tuple-set!
      (printf "tuple:1 %lld::%f\n" (tuple-ref a 0) (tref a 1))
      ;; we can fill a tuple in a single call by using tfill!
      (tfill! a 77 77.7)
      (printf "tuple:2 %lld::%f\n" (tuple-ref a 0) (tuple-ref a 1))
      (tuple-ref a 0)))) ;; return first element which is i64
</code></pre>

<h3 id="when-will-we-get-this-syntax-colouring-goodness-when-viewing-extempore-code-on-github">When will we get this syntax colouring goodness when viewing Extempore code on GitHub?</h3>

<p>GitHub doesn’t use highlight.js, it uses
<a href="https://github.com/github/linguist">linguist</a> for this sort of thing. So
getting it working on GH would involve porting the language definitions to that
project as well.</p>

<h3 id="will-it-always-be-this-complicated-to-set-up">Will it always be this complicated to set up?</h3>

<p>No, once the <a href="https://github.com/highlightjs/highlight.js/pull/1888">aformentioned issue</a>
is sorted out, it should be much easier to get a “base” package of highlight.js
from the main download website/CDN, and then to add any extras (e.g.
Extempore/xtlang) as needed. But until that happens, shenanigans are required.</p>

<h3 id="whats-with-the-jane-austen-quote-above-then">What’s with the Jane Austen quote above, then?</h3>

<p>Figuring this all out required a lot of digging around in existing packages,
learning a new <a href="https://www.npmjs.com/package/gear">node-based build system</a> and
a bunch of other things. I’m pretty capable with this sort of thing, so I got
there in the end. But it does make me a bit sad that the job of building a
community around a programming language involves so much stuff that doesn’t use
the language itself, and these days invariably involves poking around various
npm packages and staring at the Chrome developer tools.</p>

<h3 id="can-i-use-your-build-of-highlightjs-to-font-lock-xtlang-code-on-my-own-site">Can I use your build of highlight.js to font-lock xtlang code on my own site?</h3>

<p>Sure, I’d be pumped if you did. If you want, you can check out the
<a href="https://github.com/benswift/benswift.github.io/tree/hljs-with-xtlang"><code>hljs-with-xtlang</code>
branch</a> of
this repo and follow the instructions therein to make your own custom build. Or,
if you don’t want to do that, you could just use the one you’ve already
downloaded (since you’re visiting this website). Here’s a <a href="/assets/js/highlight.pack.js">direct
link</a> if you want to do
things that way.</p>
<div class="footnotes">
  <ol>
    <li id="fn:cdn">
      <p>well, off-the-CDN, anyway <a href="#fnref:cdn" class="reversefootnote">&#8617;</a></p>
    </li>
  </ol>
</div>

</article>


	  </main>
	  <footer>
  <script>
   const cafeUrls = [
	 "https://biginelli.com/",
	 "http://tilleys.com.au",
	 "https://www.facebook.com/goodbrothercafe/",
	 "https://frontgallerycafe.com",
	 "https://www.facebook.com/thecoffeegrounds",
	 "https://redbrickcoffee.com.au/redbrick/"
   ];
   const randomCafe = () => {
	 window.location.href = cafeUrls[Math.floor(Math.random()*cafeUrls.length)];
   };
  </script>

  <!-- colophon -->
  <p>
	designed & built with
	<a href="https://jekyllrb.com"><i title="Jekyll homepage" class="fas fa-vial"></i></a>,
	<a id="cafe-url" onclick="randomCafe();"><i title="the website of one of Ben's favourite coffee shops" class="fas fa-coffee" style="cursor: pointer;"></i></a> and
	<a href="https://www.youtube.com/watch?v=6H2FRxvsd2M"><i title="what is love?" class="fas fa-heart"></i></a>
	by Ben Swift
  </p>

  <!-- licence -->
  <p style="font-size: 1.3em;">
	<a title="CC BY-NC-SA licence" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">
  <i class="fab fa-creative-commons"></i>
  <i class="fab fa-creative-commons-by"></i>
  <i class="fab fa-creative-commons-nc"></i>
  <i class="fab fa-creative-commons-sa"></i>
</a>

  </p>

  <!-- throw shade on IE -->
  <p>
	uses <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/grid">CSS Grid</a>,
	works on all <a href="http://outdatedbrowser.com/en">modern browsers</a>
  </p>

  <!-- open source humblebrag -->
  <p>
	site revision <code>82eeef18</code>,
	<a href="https://github.com/benswift/benswift.github.io/blob/82eeef18/_posts/2019-01-17-highlight-js-with-xtlang-support.md">source
	available on <i title="benswift on GitHub" class="fab fa-github"></i></a>
  </p>

</footer>

	</div>
  </body>
</html>
